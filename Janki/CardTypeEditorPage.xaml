<Page
    x:Class="Janki.CardTypeEditorPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:Janki"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:vm="using:JankiBusiness"
    xmlns:muxc="using:Microsoft.UI.Xaml.Controls"
    mc:Ignorable="d"
    Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">

    <Page.DataContext>
        <vm:CardTypeEditorPageViewModel Provider="{StaticResource MediaManager}"
                                        DialogService="{StaticResource DialogService}" />
    </Page.DataContext>

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="auto" />
            <ColumnDefinition Width="3*" />
            <ColumnDefinition Width="2*" />
        </Grid.ColumnDefinitions>
        <Grid.RowDefinitions>
            <RowDefinition Height="auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <Border Grid.Column="0" Grid.Row="0" Background="{ThemeResource SystemChromeMediumColor}">
            <StackPanel Orientation="Horizontal"
                        HorizontalAlignment="Center" VerticalAlignment="Center">
                <Button Margin="5" Command="{Binding AddCardType, Converter={StaticResource CommandValueConverter}}">Add Type</Button>
                <Button Margin="5" Command="{Binding RemoveCardType, Converter={StaticResource CommandValueConverter}}">Delete Type</Button>
                <Button Margin="5" Command="{Binding AddVariant, Converter={StaticResource CommandValueConverter}}">Add Variant</Button>
                <Button Margin="5" Command="{Binding RemoveVariant, Converter={StaticResource CommandValueConverter}}">Delete Variant</Button>
            </StackPanel>
        </Border>

        <muxc:TreeView x:Name="DeckTree"
                       Grid.Column="0" Grid.Row="1" Grid.RowSpan="2"
                       HorizontalAlignment="Stretch" VerticalAlignment="Stretch"
                       Background="{ThemeResource SystemChromeLowColor}"
                       ItemsSource="{Binding CardTypes}" SelectedItem="{Binding SelectedItem, Mode=TwoWay}">
            <muxc:TreeView.ItemTemplateSelector>
                <local:CardTypeDataTemplateSelector>
                    <local:CardTypeDataTemplateSelector.CardTypeTemplate>
                        <DataTemplate>
                            <muxc:TreeViewItem Content="{Binding Name}" ItemsSource="{Binding Variants}" />
                        </DataTemplate>
                    </local:CardTypeDataTemplateSelector.CardTypeTemplate>
                    <local:CardTypeDataTemplateSelector.CardVariantTemplate>
                        <DataTemplate>
                            <muxc:TreeViewItem Content="{Binding Name}" />
                        </DataTemplate>
                    </local:CardTypeDataTemplateSelector.CardVariantTemplate>
                </local:CardTypeDataTemplateSelector>
            </muxc:TreeView.ItemTemplateSelector>
        </muxc:TreeView>

        <Border Grid.Column="1" Grid.Row="0" Grid.RowSpan="2"
                Margin="10"
                Background="{ThemeResource SystemChromeMediumColor}">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="1*" />
                    <ColumnDefinition Width="1*" />
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition Height="auto" />
                    <RowDefinition Height="*" />
                </Grid.RowDefinitions>

                <TextBlock Margin="5" Grid.Column="0" Grid.Row="0" Text="Front" />
                <TextBox Margin="5" Grid.Column="0" Grid.Row="1"
                         HorizontalAlignment="Stretch" VerticalAlignment="Stretch"
                         AcceptsReturn="True"
                         Text="{Binding SelectedVariant.FrontFormat, Mode=TwoWay}" />
                <local:CardRenderer Margin="5" Grid.Column="1" Grid.Row="1"
                                    Html="{Binding SelectedVariant.Preview.FrontHtml}" />
            </Grid>
        </Border>

        <Border Grid.Column="1" Grid.Row="2"
                Margin="10"
                Background="{ThemeResource SystemChromeMediumColor}">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="1*" />
                    <ColumnDefinition Width="1*" />
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition Height="auto" />
                    <RowDefinition Height="*" />
                </Grid.RowDefinitions>

                <TextBlock Margin="5" Grid.Column="0" Grid.Row="0" Text="Back" />
                <TextBox Margin="5" Grid.Column="0" Grid.Row="1"
                         HorizontalAlignment="Stretch" VerticalAlignment="Stretch"
                         AcceptsReturn="True"
                         Text="{Binding SelectedVariant.BackFormat}" />
                <local:CardRenderer Margin="5" Grid.Column="1" Grid.Row="1"
                                    Html="{Binding SelectedVariant.Preview.BackHtml}" />
            </Grid>
        </Border>

        <Grid Grid.Column="2" Grid.Row="0" Grid.RowSpan="2">
            <Grid.RowDefinitions>
                <RowDefinition Height="auto" />
                <RowDefinition Height="*" />
                <RowDefinition Height="auto" />
            </Grid.RowDefinitions>

            <TextBlock Margin="5" Grid.Row="0" Text="Fields" />
            <ListView Margin="5" Grid.Row="1"
                HorizontalAlignment="Stretch" VerticalAlignment="Stretch"
                      BorderThickness="1" BorderBrush="DarkGray" CornerRadius="5"
                      ItemsSource="{Binding SelectedType.Fields}" SelectedItem="{Binding SelectedField, Mode=TwoWay}"
                      AllowDrop="True" CanDragItems="True" CanReorderItems="True" />
            <Border Margin="5,5,5,10" Grid.Row="2"
                    Background="{ThemeResource SystemChromeMediumColor}">
                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" VerticalAlignment="Center">
                    <Button Margin="5" Command="{Binding AddField, Converter={StaticResource CommandValueConverter}}">Add</Button>
                    <Button Margin="5" Command="{Binding RemoveField, Converter={StaticResource CommandValueConverter}}">Remove</Button>
                </StackPanel>
            </Border>
        </Grid>

        <Grid Grid.Column="2" Grid.Row="2">
            <Grid.RowDefinitions>
                <RowDefinition Height="auto" />
                <RowDefinition Height="*" />
            </Grid.RowDefinitions>

            <TextBlock Margin="5" Grid.Row="0" Text="CSS" />
            <TextBox Margin="5" Grid.Row="1"
                     HorizontalAlignment="Stretch" VerticalAlignment="Stretch"
                     AcceptsReturn="True"
                     Text="{Binding SelectedType.Css, Mode=TwoWay}" />
        </Grid>
    </Grid>
</Page>